<h1 class="page-title">Moderation</h1>
<p class="page-subtitle">Review reports and take actions (resolve/remove) with confirmations.</p>

<mat-card class="filters">
  <mat-card-content>
    <form class="filters__grid" [formGroup]="form">
      <mat-form-field appearance="outline">
        <mat-label>Type</mat-label>
        <mat-select formControlName="type">
          <mat-option value="">All</mat-option>
          <mat-option value="report">Report</mat-option>
          <mat-option value="recipe">Recipe</mat-option>
          <mat-option value="comment">Comment</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option value="">All</mat-option>
          <mat-option value="open">Open</mat-option>
          <mat-option value="resolved">Resolved</mat-option>
          <mat-option value="removed">Removed</mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </mat-card-content>
</mat-card>

@if (vm$ | async; as vm) {
  @if (vm.loading) {
    <app-skeleton-cards [count]="6" variant="list"></app-skeleton-cards>
  } @else {
    @if (!vm.result || vm.result.total === 0) {
      <app-empty-state title="No items" message="Your queue is clear." icon="gavel"></app-empty-state>
    } @else {
      <div class="results-bar">
        <div class="results-bar__count">{{ vm.result.total }} items</div>
        <mat-paginator
          [length]="vm.result.total"
          [pageIndex]="vm.query.page - 1"
          [pageSize]="vm.query.pageSize"
          [pageSizeOptions]="[10, 20, 50]"
          (page)="onPageChange($event.pageIndex, $event.pageSize)"
        ></mat-paginator>
      </div>

      <div class="table-wrap">
        <table mat-table [dataSource]="vm.result.items" class="table">
          <ng-container matColumnDef="target">
            <th mat-header-cell *matHeaderCellDef>Target</th>
            <td mat-cell *matCellDef="let r">
              <div class="target">{{ r.targetType }} â€¢ {{ r.targetId }}</div>
              <div class="sub">{{ r.reason }}</div>
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let r">
              <span class="status">{{ r.status }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let r" class="actions">
              <button mat-button type="button" (click)="resolve(r)" [disabled]="r.status !== 'open'">Resolve</button>
              <button mat-button color="warn" type="button" (click)="remove(r)" [disabled]="r.status === 'removed'">Remove</button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['target', 'status', 'actions']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['target', 'status', 'actions']"></tr>
        </table>
      </div>
    }
  }
}
